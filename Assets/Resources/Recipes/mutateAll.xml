<?xml version="1.0" encoding="UTF-8" ?>

<!-- 

# Mutation Macro

# Mutates a residue into all possible mutants and saves each file

-->

<macro>
    <!-- Residue to mutate -->
    <userVar id="RESIDUE_ID" title="Mutate Residue" prompt="Select Residue ID to mutate">A1</userVar>
    <userBool id="OPTIMISE" title="Mutate Residue" prompt="Optimise Mutated Residue?" />
    <array id="RESIDUE_NAMES">
        <item>ALA</item><item>ARG</item><item>ASN</item><item>ASH</item><item>ASP</item>
        <item>CYS</item><item>GLU</item><item>GLH</item><item>GLN</item><item>GLY</item>
        <item>HID</item><item>HIE</item><item>HIP</item><item>ILE</item><item>LEU</item>
        <item>LYN</item><item>LYS</item><item>MET</item><item>PHE</item><item>PRO</item>
        <item>SER</item><item>THR</item><item>TRP</item><item>TYR</item><item>VAL</item>
    </array>


    <action id="copy" source="GEOMETRY" destination="clone" />

    <foreach array="RESIDUE_NAMES" var="TARGET">
        <group type="geometry" name="geometryGroup" source="GEOMETRY">

            <residueVar id="MUTANT" type="mutant">
                <residueID>$(RESIDUE_ID)</residueID>
                <target>$(TARGET)</target>
            </residueVar>

            <action id="mutateResidue">
                <residueID>$(RESIDUE_ID)</residueID>
                <target>$(TARGET)</target>
                <optimise>$(OPTIMISE)</optimise>
                <method>treeBrute</method>
            </action>

            <action id="generateAtomMap" />
            <action id="estimateChargeMultiplicity" />

            <action id="save">
                <directory>$(PROJECT)/Mutation</directory>
                <name>$(MUTANT)_$(TARGET).gjf</name>
                <connectivity>true</connectivity>
            </action>


            <action id="copy" source="clone" destination="GEOMETRY" />

        </group>
    </foreach>
</macro>