<?xml version="1.0" encoding="UTF-8" ?>

<!-- 

# Mutation Macro

# Mutates a residue then saves the file
# Also generates a report containing old and new positions, torsions and close contacts

-->

<macro>
    <!-- Residue to mutate -->
    <userVar id="RESIDUE_ID" title="Mutate Residue" prompt="Select Residue ID to mutate">A1</userVar>
    <userVar id="TARGET" title="Mutate Residue" prompt="Select 3-letter Residue name to mutate to">GLY</userVar>
    <userBool id="OPTIMISE" title="Mutate Residue" prompt="Optimise Mutated Residue?" />
    <residueVar id="MUTANT" type="mutant">
        <residueID>$(RESIDUE_ID)</residueID>
        <target>$(TARGET)</target>
    </residueVar>


    <group type="geometry" name="geometryGroup" source="$(GEOMETRY)">

        <action id="mutateResidue">
            <residueID>$(RESIDUE_ID)</residueID>
            <target>$(TARGET)</target>
            <optimise>$(OPTIMISE)</optimise>
        </action>

        <action id="report" overwrite="true">
            <directory>$(PROJECT)/Mutation</directory>
            <name>$(MUTANT).log</name>
            <items>
                <text>Mutant: $(MUTANT)</text>

                <text>Old Sequence:</text>
                <geometry source="$(GEOMETRY)"><sequence /></geometry>

                <text>New Sequence:</text>
                <geometry source="geometryGroup"><sequence /></geometry>

                <text>Before Mutation:</text>
                <residues source="$(GEOMETRY)" residueIDs="$(RESIDUE_ID)">
                    <positions />
                    <torsionAngles />
                    <contact />
                </residues>

                <text>After Mutation:</text>
                <residues source="geometryGroup" residueIDs="$(RESIDUE_ID)">
                    <positions />
                    <torsionAngles />
                    <contact />
                </residues>


            </items>
        </action>

        <action id="save">
            <directory>$(PROJECT)/Mutation</directory>
            <name>$(MUTANT).xat</name>
            <connectivity />
        </action>

    </group>
</macro>